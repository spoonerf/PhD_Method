---
title: "Global GGplot Map"
output: html_document
---

```{r}
library(rgdal)
library(ggplot2)

```

```{r,echo=FALSE}
temp<-read.csv("All_LPI_Mean_Temp_Slope_nobuff.csv")
luc<-read.csv("LUC_distance_all.csv")
LPI<-read.csv("LPI_populations_IP_fishedit_20140310_nonconf.csv")

pop<-read.csv("Global_Population_Trends_Rsq_Lambda_16_03_18.csv")

temp<-temp[,c("ID", "Estimate")]

LPI<-LPI[,c("ID","Binomial","Common_name","Country","Region", "System", "Class","Specific_location", "Longitude", "Latitude", "Primary_threat", "Secondary_threat", "Tertiary_threat")]

df<-merge(merge(temp,luc, by="ID", all=TRUE), merge(LPI, pop, by="ID", all=TRUE),by="ID", all=TRUE)

locs<-subset(df, !is.na(Estimate)&r_sq >= 0.5  & !is.na(LUC_dist)&length_time >=5 & System!="Marine" &Specific_location == 1 &(Class=="Mammalia"|Class=="Aves"))
```


```{r, eval=FALSE}

locs<-read.csv("my_locations.csv")

```


```{r}
library(plyr)
#counting duplicates at each location
sp_dups<-data.frame(ddply(locs,.(Longitude,Latitude),nrow))
sp_dups$loc_id<-1:length(sp_dups$Longitude)
sp_dups_df<-merge(sp_dups, locs, by=c("Longitude","Latitude"))

```

```{r}
loc<-data.frame(sp_dups_df$Longitude,sp_dups_df$Latitude,sp_dups_df$V1)
head(loc)
loc<-unique(loc)
colnames(loc)<-c("Longitude", "Latitude", "V1")

coordinates(loc)<-c("Longitude","Latitude")
proj4string(loc) <- CRS("+proj=longlat")


```

```{r}
wmap <- readOGR(dsn="ne_110m_land.shp", layer="ne_110m_land")
coast<-readOGR(dsn="ne_110m_coastline.shp", layer="ne_110m_coastline")
bbox<-readOGR("ne_10m_wgs84_bounding_box.shp", layer="ne_10m_wgs84_bounding_box") 

```

```{r, eval=FALSE, echo=FALSE}
#wmap <- readOGR(dsn="ne_110m_land.shp", layer="ne_110m_land")
wmap <- readOGR(dsn="ne_110m_land.shp", layer="ne_110m_coastline")
#countries <- readOGR("ne_50m_admin_0_countries.shp", layer="ne_50m_admin_0_countries")
#bbox<-readOGR("ne_10m_wgs84_bounding_box.shp", layer="ne_10m_wgs84_bounding_box") 
```


```{r}

wmap_df<-fortify(wmap)
coast_df<-fortify(coast)
loc_df<-data.frame(loc)
bbox_df<-fortify(bbox)

```

```{r}

theme_opts <- list(theme(panel.grid.minor = element_blank(),
                         panel.grid.major = element_blank(),
                         panel.background = element_blank(),
                         plot.background = element_rect(fill="white"),
                         panel.border = element_blank(),
                         axis.line = element_blank(),
                         axis.text.x = element_blank(),
                         axis.text.y = element_blank(),
                         axis.ticks = element_blank(),
                         axis.title.x = element_blank(),
                         axis.title.y = element_blank(),
                         plot.title = element_text(size=22)))
```

```{r}
h


library(maps)
library(mapdata)

ggplot(data=loc_df, aes(Longitude, Latitude, group=NULL,fill=NULL,size=V1))+#, fill=hole)) + 
  borders(fill="light grey",colour="light grey")+
  geom_point(color="black",alpha=I(7/10))+
  scale_size(range=c(1,7), guide = "legend",labs(size="No. of Populations"))+
  #scale_fill_manual(values=c("#262626", "#e6e8ed"), guide="none")+
  theme_opts
  

```


